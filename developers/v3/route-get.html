<h1 lang="ko">길찾기 경로 지도에 그리기 </h1>
<h1 lang="en">Drawing directions on a map</h1>
</br>
<h4 lang="ko">MapDraw.getRouteOn()으로 지도에 출발지에서 목적지까지의 경로를 그릴 수 있습니다.</h4>
<h4 lang="en">MapDraw.getRouteOn() allows you to draw a route from the origin to the destination on the map.</h4>
<span lang="ko"></br>mapDraw.setNavigationOption()으로 경로를 그리는 주행선과 모의주행 아이콘에 대한 옵션을 설정할 수 있습니다. getRouteOn() 전에 먼저 호출해야 합니다.</span>
<span lang="en"></br>With mapDraw.setNavigationOption(), you can set the options for the driving line drawing the route and the driving icon. It must be called before getRouteOn() first.</span>
<span lang="ko"></br>옵션은 주행선, 모의주행, 아이콘 등에 대하여 줄 수 있으며 대표적인 예는 아래와 같습니다.</span>
<span lang="en"></br>Options can be given for driving lines, simulation driving, icons, etc. A typical example is as follows.</span>
<span lang="ko"></br>옵션에 대한 더 자세한 설명은 <a href="https://dabeeo.github.io/web_api/jsdocs/global.html#NavigationOption" target="_blank">[API Reference의 Navigation Option]</a>를 참조하세요.</span>
<span lang="en"></br>For a more detailed description of the options, see <a href="https://dabeeo.github.io/web_api/jsdocs/global.html#NavigationOption" target="_blank">[API Reference Navigation Option]</a></span>
<pre lang="ko">
    <code>
        //네비게이션 옵션 설정
        mapDraw.setNavigationOption({
            lineColor: "#00008b",       // 길찾기 주행선 색상 
            lineZ: 40,                  // 길찾기 주행선 z축 높이 
            speedRate: 3,               // 모의주행 아이콘 속도
        });
    </code>
</pre>
<pre lang="en">
    <code>
        //set navigation options
        mapDraw.setNavigationOption({
            lineColor: "#00008b",       // route line color 
            lineZ: 40,                  // route line z 
            speedRate: 3,               // simulation icon speed
        });
    </code>
</pre>
<span lang="ko"></br>경로를 그리는 방법은 아래 예제에서 보는 바와 같이 mapDraw.getRouteOn()을 호출하면 됩니다.</span>
<span lang="en"></br>To draw a route, just call mapDraw.getRouteOn() as shown in the example below.</span>
<span lang="ko"></br>인자로는 출발지, 목적지, 층간이동수단, 경유지, 반환값에 대한 옵션을 지정할 수 있습니다.</span>
<span lang="en"></br>As an argument, you can specify options for the origin, destination, means of interfloor movement, waypoints, and return values.</span>
<span lang="ko"></br>출발지와 목적지는 반드시 지정하여야 하며 나머지는 선택사항입니다. 지정하지 않을 경우 디폴트값이 적용됩니다.경유지는 복수가 지원되므로 배열형태로 입력해야 합니다.</span>
<span lang="en"></br>The origin and destination must be specified, the rest are optional. If not specified, the default value is applied. Multiple waypoints are supported, so they must be entered in the form of an array.</span>
<span lang="ko"></br>출발지와 목적지, 경유지는 poiID로 하거나 특정좌표 모두 가능하며, poi 속성을 그대로 넘겨도 가능합니다.</span>
<span lang="en"></br>The starting point, destination, and waypoint can be poiID or specific coordinates, and you can pass the poi attribute as it is.</span>
<span lang="ko"></br>층간이동경로는 추천, 계단, 엘리베이터, 에스컬레이터 4가지 타입이 존재합니다. 지정하지 않는 경우 추천으로 선택됩니다. 추천은 최단경로입니다.</span>
<span lang="en"></br>There are 4 types of movement between floors: recommended, stairs, elevators, and escalators. If not specified, it will be selected as a recommendation. Recommendation is the shortest route.</span>
<span lang="ko"></br>MapDraw.getRouteOn()에 대한 자세한 정보는 <a href="https://dabeeo.github.io/web_api/jsdocs/MapDraw.html#getRouteOn" target="_blank">[API Reference의 MapDraw.getRouteOn]</a>에 설명되어 있습니다.</span>
<span lang="en"></br>For more information on MapDraw.getRouteOn(), see <a href="https://dabeeo.github.io/web_api/jsdocs/MapDraw.html#getRouteOn" target="_blank">[API Reference MapDraw.getRouteOn]</a>.</span>
<pre lang="ko">
    <code>
        //길찾기 경로 그리기
        result = mapDraw.getRouteOn(
            originPoi,            // 출발지
            destPoi,              // 도착지
            "recommendation",     // 층간이동경로
            [],                   // 경유지
            retResponse = true    // 반환값에 대한 옵션, true로 하는 경우 소요시간과 거리 반환받음. false인 경우 소요시간만 반환받음. 
        );

    </code>
</pre>
<pre lang="en">
    <code>
        //draw directions
        result = mapDraw.getRouteOn(
            originPoi,            // origination point
            destPoi,              // destination point
            "recommendation",     // means of moving between floors
            [],                   // waypoints
            retResponse = true    // Option for the return value, if set to true, the required time and distance are returned. 
                                  // If false, only the required time is returned. 
        );

    </code>
</pre>

</br>
<span lang="ko"></br>아래는 지도에 포함된 poi를 select하여 길찾기 경로를 그리고 모의주행을 할 수 있는 코드의 일부입니다.</span>
<span lang="en"></br>Below is a part of the code that can select a poi included in the map to draw a route and simulate driving.</span>
<span lang="ko"></br>실행 페이지와 전체 코드는 <a href="https://dabeeo.github.io/web_api/example/#getRouteOn" target="_blank">[examples의 simple navigation]</a>를 참조하세요.</span>
<span lang="en"></br>The example page and full code are at <a href="https://dabeeo.github.io/web_api/example/#getRouteOn" target="_blank">[examples simple navigation]</a>.</span>
<pre><code>
    <div class="button-container">
        <button type="button" class="button-menu">
            Navigation Test
        </button>
    </div>
    <div class="control-container">
        <div class="inline-container">
            <div class="inline-label">floor</div>
            <select type="text" class="inline-input" name="floor">
                <option selected value="default">default</option>
            </select>
        </div>
        <div class="divider"></div>
        <div class="inline-container">
            <div class="inline-label">origination</div>
            <select type="text" class="inline-input" id="poiOrigin">
            </select>
        </div>
        <div class="inline-container">
            <div class="inline-label">destination</div>
            <select type="text" class="inline-input" id="poiDestination">
            </select>
        </div>
        <div class="inline-container">
            <input type="button" class="inline-input" id="getRouteOn" value="get directions">
            <input type="button" class="inline-input" id="getRouteOff" value="off">
        </div>
    </div>

    <div id="map"></div>

    <script>
        let mapFloorName = {};

        window.addEventListener("load", function () {
            initMap();
        });

        function initMap () {
            var mapContainer = document.getElementById('map');
            var authorization = new indoorMapApi.Authorization({
                clientId: "6Lwuu9wa4wta0NiHwy1fO5",
                clientSecret: "93ab5dbaf7fa6c9017cf9cb9ef4dc8fd"
            });
            var mapOptions = {
                authorization: authorization
            };
            new indoorMapApi.MapView(
                mapContainer,
                mapOptions,
                function (response) {
                    var code = response.getCode();

                    if (code === 200) {
                        mapDraw = response.getPayload().mapDraw;
                        // do something
                        console.log("map view success!")
                        handlePoiInfo(mapDraw.response);
                        handleGetRouteOnEvent();
                    }
                }
            );
        }

        //////////////////////////////////////////////////////////////////////////////////
        // poi select
        function handlePoiInfo (response) {
            mapPoiInfo = response.poiInfo;

            let floorInfo = response.floorInfo;
            for (let i = 0; i < floorInfo.length; i++) {
                var floor = floorInfo[i];
                mapFloorName[floor.id] = floor.name[0].text;
            }
            makePoiSelect("poiOrigin");
            makePoiSelect("poiDestination");
        }

        function makePoiSelect (id) {
            let element = document.querySelector("select#" + id);
            for (let index = 0; index < mapPoiInfo.length; index++) {
                let poi = mapPoiInfo[index];
                if (poi.title === "") continue;

                let option = document.createElement("option");
                option.value = index;
                option.innerHTML = mapFloorName[poi.floorId] + "&nbsp;&nbsp;&nbsp;" + poi.title;
                element.appendChild(option);
            }
        }
        // draw route and delete route
        function handleGetRouteOnEvent () {
            document.querySelector("#getRouteOn").addEventListener("click", function (e) {
                // select origin poi and destination poi
                let originPoi = getPoi("poiOrigin");
                let destPoi = getPoi("poiDestination");

                //set navigation option
                mapDraw.setNavigationOption({
                    lineColor: "#00008b",
                    lineZ: 40,
                    speedRate: 3,
                });

                result = mapDraw.getRouteOn(originPoi, destPoi, "recommendation", [], retResponse = true);
                // if route does not exist
                if (result === undefined) {
                    alert("요청하신 경로가 존재하지 않습니다.\n출발지와 도착지를 확인하세요");
                    return;
                }
            });
            document.querySelector("#getRouteOff").addEventListener("click", function (e) {
                // remove route from the map
                mapDraw.getRouteOff();
            });
        }

        function getPoi (id) {
            let index = document.querySelector("select#" + id).value;
            return mapPoiInfo[index];
        }
    </script>
    
</code></pre>

<span lang="ko"></br>위 예제를 실행한 화면은 다음과 같습니다.</span>
<span lang="en"></br>The result of the above code is below. </span>
<iframe height=1000px src="https://dabeeo.github.io/web_api/samples/getRouteOn.html"></iframe>
</br>
</br>
</br>
</br>
</br>
</br>
</br>