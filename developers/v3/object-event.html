<h1>클릭시 poi의 정보 표시하기 </h1>
</br>
<h4>object-click 또는 poi-click 이벤트를 이용하여 지도의 POI 정보를 사용자에게 표시할 수 있습니다. </h4>
</br>다비오맵스 플랫폼에서 poi metadata에 입력된 정보는 object가 클릭되거나 poi가 클릭될 때 event를 통해 전달됩니다.
</br>이를 통해 poi의 여러가지 내용을 팝업창 등을 통해 사용자에게 알릴 수 있습니다.
</br>object 클릭시에는 object에 연결된 poi의 정보가 전달됩니다. 한개의 object에 여러개의 poi가 연결될 수 있습니다.
</br>object 클릭 이벤트에 대한 자세한 설명은 <a href="https://dabeeo.github.io/web_api/jsdocs/global.html#event:object-click" target="_blank">[API Reference의 object click event]</a>를 참조하세요.
</br>poi 클릭 이벤트에 대한 자세한 설명은 <a href="https://dabeeo.github.io/web_api/jsdocs/global.html#event:poi-click" target="_blank">[API Reference의 poi click event]</a>를 참조하세요.
</br>이벤트는 아래와 같은 방법으로 받을 수 있습니다.
<pre>
    <code>
        document.querySelector("#map").addEventListener("object-click", function (e) {
            console.log("object click ", e.detail);
        }    
    </code>
</pre>

</br>
</br>아래는 지도에 포함된 object를 클릭하면 object에 연결된 poi의 정보를 보여주는 코드의 일부입니다.
<br>실행 페이지와 전체 코드는 <a href="https://dabeeo.github.io/web_api/example/#objectClickEvent" target="_blank">[examples의 object click event]</a>를 참조하세요.
<pre><code>
    <!-- The Modal -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Some text in the Modal..</p>
        </div>
    </div>
    <div class="button-container">
        <button type="button" class="button-menu">
            Object Click Event Test
        </button>
    </div>
    <div id="map"></div>

    <script>

        window.addEventListener("load", function () {
            initMap();
        });

        function initMap () {
            var mapContainer = document.getElementById('map'); // 지도를 표시할 div
            // 지도 인증정보
            var authorization = new indoorMapApi.Authorization({
                clientId: "6Lwuu9wa4wta0NiHwy1fO5",
                clientSecret: "93ab5dbaf7fa6c9017cf9cb9ef4dc8fd"
            });
            var mapOptions = {
                authorization: authorization,
                camera: "2d",
                zoom: 200
            };
            // 지도를 표시할 div, 옵션으로 생성 후 로딩이 완료되면 콜백으로 결과를 리턴합니다
            new indoorMapApi.MapView(
                mapContainer, // 컨테이너
                mapOptions, // 옵션
                function (response) { // 맵 로드 콜백
                    var code = response.getCode();
                    if (code === 200) {
                        mapDraw = response.getPayload().mapDraw;
                        // do something
                        console.log("map view success!")
                        initClickEvent();
                    }
                }
            );
        };
        //////////////////////////////////////////////////////////////////////////////////
        // click event init
        function initClickEvent () {
            var modal = document.querySelector("#myModal");
            var span = document.querySelector(".close");

            /* object 클릭시 poi 정보 전달 */
            document.querySelector("#map").addEventListener("object-click", function (e) {
                console.log("object click ", e.detail);
                if (e.detail === null) return;
                let message = "";

                //클릭시 좌표에 연결 된 object가 여러개 올수 있으므로 array를 순회하면서 확인 후  poi 처리 
                for (let index of e.detail) {
                    //하나의 Object에 여러개의 poi가 연결된 경우
                    for (let p of index.poiDataArr) {
                        message += `poi title : ${JSON.stringify(p.title)} \npoi position : ${JSON.stringify(p.position)}`
                        // poi의 메타데이터에 있는 내용
                        for (let m of p.metadatas) {
                            message += `\n${m.lang}`;
                            for (let meta of m.metadatas) {
                                if (meta.text == '') continue;
                                data = JSON.parse(meta.text);
                                for (key in data) {
                                    console.log(key, ":", data[key])
                                    message += `\n${key}  : ${data[key]}`;
                                }
                            }
                        }
                    }
                }
                // modal.innerHTML = alertMessage;
                if (message === "") return;
                let modalContent = document.querySelector(".modal-content p");
                modalContent.innerText = message;
                modal.style.display = "block";
            });
            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
    </script>    
</code></pre>

</br>전체코드의 실행화면은 다음과 같습니다. Object를 클릭하면 poi 정보가 팝업창으로 보입니다.
</br>
<iframe height=1000px src="https://dabeeo.github.io/web_api/samples/objectClickEvent.html"></iframe>
</br>
</br>
</br>
</br>
</br>
</br>
</br>