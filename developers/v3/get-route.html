<h1>길찾기 경로 그리기와 모의주행 </h1>
</br>
<h4>MapDraw.getRouteOn()으로 지도에 출발지에서 목적지까지의 경로를 그릴 수 있습니다.</h4>
</br>경로를 그리는 주행선과 경로의 모의주행에 대하여 옵션을 설정할 수 있습니다. 설정을 원하는 경우 getRouteOn()를 호출하기 전에 먼저 호출해야 합니다.
</br>옵션은 주행선, 모의주행, 아이콘 등에 대하여 줄 수 있으며 대표적인 예는 아래와 같습니다.
</br>옵션에 대한 더 자세한 설명은 <a href="https://dabeeo.github.io/web_api/jsdocs/global.html#NavigationOption" target="_blank">[API Reference의 Navigation Option]</a>를 참조하세요.
<pre>
    <code>
        //네비게이션 옵션 설정
        mapDraw.setNavigationOption({
            lineColor: "#00008b",       // 길찾기 주행선 색상 
            lineZ: 40,                  // 길찾기 주행선 z축 높이 
            speedRate: 3,               // 모의주행 아이콘 속도
        });
    </code>
</pre>
</br>경로를 그리는 방법은 아래 예제에서 보는 바와 같이 mapDraw.getRouteOn()을 호출하면 됩니다.
</br>인자로는 출발지, 목적지, 층간이동수단, 경유지, 반환값에 대한 옵션을 지정할 수 있습니다.
</br>출발지와 목적지는 반드시 지정하여야 하며 나머지는 선택사항입니다. 지정하지 않을 경우 디폴트값이 적용됩니다.경유지는 복수가 지원되므로 배열형태로 입력해야 합니다.
</br>출발지와 목적지, 경유지는 poiID로 하거나 특정좌표 모두 가능하며, poi 속성을 그대로 넘겨도 가능합니다.
</br>층간이동경로는 추천, 계단, 엘리베이터, 에스컬레이터 4가지 타입이 존재합니다. 지정하지 않는 경우 추천으로 선택됩니다.
<pre>
    <code>
        //길찾기 경로 그리기
        result = mapDraw.getRouteOn(originPoi, destPoi, "recommendation", [], retResponse = true);

    </code>
</pre>
</br>MapDraw.getRouteOn()에 대한 자세한 정보는 <a href="https://dabeeo.github.io/web_api/jsdocs/MapDraw.html#getRouteOn" target="_blank">[API Reference의 MapDraw.getRouteOn]</a>에 설명되어 있습니다.
</br>
</br>아래는 지도에 포함된 poi를 select하여 길찾기 경로를 그리는 코드의 일부입니다.
<br>실행 페이지와 전체 코드는 <a href="https://dabeeo.github.io/web_api/example/#getRouteOn">[examples의 simple navigation]</a>를 참조하세요.
<pre>
    <code>
        <div class="button-container">
            <button type="button" class="button-menu">
                Navigation Test
            </button>
        </div>
        <div class="control-container">
            <div class="inline-container">
                <div class="inline-label">층선택</div>
                <select type="text" class="inline-input" name="floor">
                    <option selected value="default">default</option>
                </select>
            </div>
            <div class="divider"></div>
            <div class="inline-container">
                <div class="inline-label">출발지</div>
                <select type="text" class="inline-input" id="poiOrigin">
                </select>
            </div>
            <div class="inline-container">
                <div class="inline-label">도착지</div>
                <select type="text" class="inline-input" id="poiDestination">
                </select>
            </div>
            <div class="inline-container">
                <input type="button" class="inline-input" id="getRouteOn" value="길찾기">
                <input type="button" class="inline-input" id="getRouteOff" value="끄기">
            </div>
            <div class="inline-container">
                <input type="button" class="inline-input" id="startRouteAnimation" value="모의주행">
                <input type="button" class="inline-input" id="stopRouteAnimation" value="끄기">
            </div>
        </div>
    
        <div id="map"></div>
    
        <script>
            let mapFloorName = {};

            window.addEventListener("load", function () {
                initMap();
            });

            function initMap () {
                var mapContainer = document.getElementById('map'); // 지도를 표시할 div

                // 지도 인증정보
                var authorization = new indoorMapApi.Authorization({
                    clientId: "6Lwuu9wa4wta0NiHwy1fO5",
                    clientSecret: "93ab5dbaf7fa6c9017cf9cb9ef4dc8fd"
                });
                var mapOptions = {
                    authorization: authorization
                };

                // 지도를 표시할 div, 옵션으로 생성 후 로딩이 완료되면 콜백으로 결과를 리턴합니다
                new indoorMapApi.MapView(
                    mapContainer, // 컨테이너
                    mapOptions, // 옵션
                    function (response) { // 맵 로드 콜백
                        var code = response.getCode();

                        if (code === 200) {
                            mapDraw = response.getPayload().mapDraw;
                            // do something
                            console.log("map view success!")
                            handlePoiInfo(mapDraw.response);
                            handleGetRouteOnEvent();
                            handleRouteAnimationEvent();
                        }
                    }
                );
            }

            //////////////////////////////////////////////////////////////////////////////////
            // poi select 만들기
            function handlePoiInfo (response) {
                mapPoiInfo = response.poiInfo;
                //poi select에서 사용할 층이름 만들기 
                let floorInfo = response.floorInfo;
                for (let i = 0; i < floorInfo.length; i++) {
                    var floor = floorInfo[i];
                    mapFloorName[floor.id] = floor.name[0].text;
                }
                //상단 poi select 만들기
                makePoiSelect("poiOrigin");
                makePoiSelect("poiDestination");
            }

            //poi select창에 poi list 만들기
            function makePoiSelect (id) {
                let element = document.querySelector("select#" + id);
                for (let index = 0; index < mapPoiInfo.length; index++) {
                    let poi = mapPoiInfo[index];
                    if (poi.title === "") continue;

                    let option = document.createElement("option");
                    option.value = index;
                    option.innerHTML = mapFloorName[poi.floorId] + "&nbsp;&nbsp;&nbsp;" + poi.title;
                    element.appendChild(option);
                }
            }
            //길찾기 경로 그리기와 지우기 
            function handleGetRouteOnEvent () {
                document.querySelector("#getRouteOn").addEventListener("click", function (e) {
                    //출발지와 도착지 선택
                    let originPoi = getPoi("poiOrigin"); //출발지 POI id 
                    let destPoi = getPoi("poiDestination"); //도착지 POI id 

                    //네비게이션 옵션 설정
                    mapDraw.setNavigationOption({
                        lineColor: "#00008b",       // 길찾기 주행선 색상 
                        lineZ: 40,                  // 길찾기 주행선 z축 높이 
                        speedRate: 3,               // 모의주행 아이콘 속도
                    });

                    //길찾기 경로 그리기
                    result = mapDraw.getRouteOn(originPoi, destPoi, "recommendation", [], retResponse = true);
                    //경로가 존재하지 않는 경우
                    if (result === undefined) {
                        alert("요청하신 경로가 존재하지 않습니다.\n출발지와 도착지를 확인하세요");
                        return;
                    }
                });
                document.querySelector("#getRouteOff").addEventListener("click", function (e) {
                    //길찾기 경로 지우기
                    mapDraw.getRouteOff();
                });
            }

            function getPoi (id) {
                let index = document.querySelector("select#" + id).value;
                return mapPoiInfo[index];
            }
            //모의주행 시작과 정지
            function handleRouteAnimationEvent () {
                //모의주행 시작
                document.querySelector("#startRouteAnimation").addEventListener("click", function (e) {
                    mapDraw.startRouteAnimation();
                });
                //모의주행 정지
                document.querySelector("#stopRouteAnimation").addEventListener("click", function (e) {
                    mapDraw.stopRouteAnimation();
                });
            }

        </script>
    </code>
</pre>

</br>실행화면은 다음과 같습니다.
</br>
<iframe height=1000px src="https://dabeeo.github.io/web_api/samples/getRouteOn.html"></iframe>
</br>
</br>
</br>
</br>
</br>
</br>
</br>