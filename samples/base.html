<!DOCTYPE html>
<html lang="en">
	<head>
		<title>dabeeo demo site</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

		<style>
            body {
                background-color: #f0f0f0;
                color: #0e0e0e;
                margin:0;
                overflow:hidden; 
            }

            .btn-container {
                position : absolute;
                top:50px;
                left:70px;
                box-sizing: border-box;
                z-index:1;
            }


            .param {
                display:none;
            }
            .control-container {
                position : absolute;
                right:10px;
                top:10px;
            }
            .floors-container{
                /* float:left; */
                position:absolute;
                left: 10px;
                top: 50px;
            }
            .floor {
                width: 36px;
                height: 36px;
                background: #FFFFFF;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #B7B9C1;
                border-bottom: 1px solid #EDEDED;
                box-sizing: border-box;
                cursor: pointer;
            }
            .themes-container{
                /* float:left; */
                position:absolute;
                left: 10px;
                bottom: 50px;
            }

            .theme {
                width: 100px;
                height: 36px;
                background: #FFFFFF;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #B7B9C1;
                border-bottom: 1px solid #EDEDED;
                box-sizing: border-box;
                cursor: pointer;
            }

            .camera-container{
                /* float:left; */
                position:absolute;
                left: 100px;
                top: 50px;
            }

            .camera {
                float:left;
                width: 100px;
                height: 36px;
                background: #FFFFFF;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #B7B9C1;
                border-bottom: 1px solid #EDEDED;
                box-sizing: border-box;
                cursor: pointer;
            }

            .show-poi-container{
                /* float:left; */
                position:absolute;
                left: 200px;
                top: 50px;
            }
            .map-name-container {
                /* float:left; */
                position:absolute;
                right: 10px;
                top: 5px;
                width: 300px;
                height: 36px;
                background: #FFFFFF;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #854e17;
                border-bottom: 1px solid #EDEDED;
                box-sizing: border-box;
                cursor: pointer;

            }
            .show-poi {
                float:left;
                width: 80px;
                height: 36px;
                background: #FFFFFF;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #B7B9C1;
                border-bottom: 1px solid #EDEDED;
                box-sizing: border-box;
                cursor: pointer;
            }

            .floor-on, .theme-on, .camera-on, .show-poi-on{
                color: red;
            }

			body {
				background-color: #f0f0f0;
				color: #aaaaaa;
			}
			.info-container {
				position : absolute;
				top:10px;
				right:100px;
				left:10px;
				width:50%;
				box-sizing: border-box;
				z-index:1;
			}
			.direction-container {
				position : absolute;
                top:50px;
                font-size: 13px;
                color: #aaaaaa;
				right:10px;
				box-sizing: border-box;
				z-index:1;
			}
		</style>
    <script type="module" src="https://assets.dabeeomaps.com/upload/JS/jsMapAPI_pre_release.js"></script>
</head>
	<body>
        <div id="map"></div>        
        <script>

            window.addEventListener("load", function () {  
                initMap();
            });

            function initMap() {
                let mapContainer = document.getElementById('map'); // 지도를 표시할 div
                    
                    // 지도 인증정보
                    let authorization = new indoorMapApi.Authorization({
                    clientId: "28AXw_veA2YbNKDP6poTpT",
                    clientSecret: "70c540c169af62808f4da3709e988e06"
                    });
                
                    let mapOptions = {
                    authorization: authorization
                    };
                

                // 지도를 표시할 div, 옵션으로 생성 후 로딩이 완료되면 콜백으로 결과를 리턴합니다
                new indoorMapApi.MapView(
                    mapContainer, // 컨테이너
                    mapOptions, // 옵션
                    function (response) { // 맵 로드 콜백
                        console.log(response)
                        let code = response.getCode();
            
                        if (code === 200) {
                            mapView = response.getPayload().mapView;
                            mapDraw = response.getPayload().mapDraw;
                            // do something
                            console.log("map view success!")
                            initFloorBtn(mapDraw.response.floorInfo)
                            initThemeBtn(mapDraw.response.themeInfo)
                            initCameraBtn();
                            // initShowPoiBtn();
                            initMapName(mapDraw.response.mapName);
                        }
                    } 
                );
            };
            function initMapName(name) {
                const mapNameContainer = document.createElement("DIV")
                mapNameContainer.classList.add('map-name-container');
                const mapElement = document.querySelector("#map");
                mapElement.insertAdjacentElement("afterbegin", mapNameContainer);
                mapNameContainer.innerText = name; 
            }

            function initShowPoiBtn() {
                const showPoiContainer = document.createElement("DIV")
                showPoiContainer.classList.add('show-poi-container');
                
                const mapElement = document.querySelector("#map");

                mapElement.insertAdjacentElement("afterbegin", showPoiContainer);
                //층 버튼 추가하기
                let showPoiHTML ="";
                showPoiHTML +=`<div class="show-poi show-poi-on" id="show-poi-true">show poi</div>`
                showPoiHTML +=`<div class="show-poi" id="show-poi-false">hide poi</div>`
                showPoiContainer.innerHTML = showPoiHTML;
                showPoiContainer.addEventListener("click", ({target})=>{
                    if(target.className === "show-poi" ) {
                        document.querySelector(".show-poi-on").classList.remove("show-poi-on");
                        target.classList.add("show-poi-on");
                        if (target.id === "show-poi-true") {
                            mapDraw.changeShowPoi({showPoi: true});
                        } else {
                            mapDraw.changeShowPoi({showPoi: false});
                        }
                    }
                });
            }


            function initCameraBtn() {
                const cameraContainer = document.createElement("DIV")
                cameraContainer.classList.add('camera-container');
                
                const mapElement = document.querySelector("#map");

                mapElement.insertAdjacentElement("afterbegin", cameraContainer);
                //층 버튼 추가하기
                let cameraHTML ="";
                cameraHTML +=`<div class="camera" id="2d">2d</div>`
                cameraHTML +=`<div class="camera camera-on" id="3d">3d</div>`
                cameraContainer.innerHTML = cameraHTML;
                cameraContainer.addEventListener("click", ({target})=>{
                    if(target.className === "camera" ) {
                        document.querySelector(".camera-on").classList.remove("camera-on");
                        target.classList.add("camera-on");
                        mapDraw.changeCamera({camera: target.id});
                    }
                });
            }

            function initFloorBtn(floorInfo) {
                console.log(floorInfo);
                const floorsContainer = document.createElement("DIV")
                floorsContainer.classList.add('floors-container');// .className="floors-container";

                const mapElement = document.querySelector("#map");

                mapElement.insertAdjacentElement("afterbegin", floorsContainer);
                //층 버튼 추가하기
                let floorsHTML ="";
                floorInfo.forEach((v)=>{
                    if (v.defaultYn) {
                        floorsHTML +=`<div class="floor floor-on" id=${v.id}>${v.name[0].text}</div>`
                    } else {
                        floorsHTML +=`<div class="floor" id=${v.id}>${v.name[0].text}</div>`
                    }
                });
                floorsContainer.innerHTML = floorsHTML;
                floorsContainer.addEventListener("click", ({target})=>{
                    if(target.className === "floor" ) {
                        document.querySelector(".floor-on").classList.remove("floor-on");
                        target.classList.add("floor-on");
                        mapDraw.redrawMap({floor: target.id});
                    }
                });
            }

            function initThemeBtn(themeInfo) {
                console.log(themeInfo);
                const themesContainer = document.createElement("DIV")
                themesContainer.classList.add('themes-container');
                
                const mapElement = document.querySelector("#map");

                mapElement.insertAdjacentElement("afterbegin", themesContainer);
                //층 버튼 추가하기
                let themesHTML ="";
                themeInfo.forEach((v)=>{
                    if (v.defaultYn) {
                        themesHTML +=`<div class="theme theme-on" id=${v.id}>${v.name}</div>`
                    } else {
                        themesHTML +=`<div class="theme" id=${v.id}>${v.name}</div>`
                    }
                });
                themesContainer.innerHTML = themesHTML;
                themesContainer.addEventListener("click", ({target})=>{
                    if(target.className === "theme" ) {
                        document.querySelector(".theme-on").classList.remove("theme-on");
                        target.classList.add("theme-on");
                        mapDraw.redrawMap({theme: target.id});
                    }
                });
            }

        </script>		
    </body>
</html>
